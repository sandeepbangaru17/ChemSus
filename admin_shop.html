<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Shop | ChemSus Technologies Pvt Ltd</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="assets/logo.png">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #0074c7;
      --primary-dark: #00508a;
      --accent: #00b8b0;
      --bg: #F3F7FB;
      --ink: #1f2933;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Open Sans", Arial, sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
    }

    a { text-decoration: none; color: inherit; }

    .sidebar {
      width: 240px;
      background: var(--primary);
      color: #ffffff;
      border-right: 3px solid var(--accent);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 1000;
    }

    .nav-logo {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: "Montserrat", sans-serif;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 0.02em;
      color: #ffffff;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      white-space: nowrap;
    }

    .nav-logo-img { height: 24px; width: auto; }

    .nav-menu {
      list-style: none;
      padding: 8px 0;
      flex: 1;
      overflow-y: auto;
    }

    .nav-menu li a {
      display: block;
      color: #ffffff;
      border-left: 3px solid transparent;
      padding: 10px 20px;
      font-size: 13.5px;
      transition: all 0.2s ease;
    }

    .nav-menu li a.active,
    .nav-menu li a:hover { 
      background: rgba(255,255,255,0.1);
      border-left-color: var(--accent);
    }

    .search-section {
      padding: 12px 20px 16px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }

    .search-form { position: relative; }

    .search-input {
      width: 100%;
      padding: 8px 32px 8px 12px;
      border-radius: 6px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.1);
      color: #ffffff;
      font-size: 12.5px;
      outline: none;
    }

    .search-input::placeholder { color: #d1d5db; }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 14px;
      height: 14px;
      color: #ffffff;
      pointer-events: none;
    }

    .main-wrapper {
      margin-left: 240px;
      flex: 1;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .hero {
      position: relative;
      overflow: hidden;
      background: radial-gradient(circle at top left, rgba(0,184,176,0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(0,116,199,0.2), transparent 55%),
                  #041424;
      height: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: #fff;
      border-top: 3px solid var(--accent);
    }

    .hero::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 2px, transparent 3px),
        radial-gradient(circle at 80% 70%, rgba(255,255,255,0.08) 0, rgba(255,255,255,0.08) 2px, transparent 3px);
      background-size: 140px 140px;
      opacity: 0.6;
      pointer-events: none;
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 900px;
      padding: 0 20px;
    }

    .hero-kicker {
      font-size: 13px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      margin-bottom: 8px;
      color: #b9e6ff;
    }

    .hero-title {
      font-family: "Montserrat", sans-serif;
      font-size: 40px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .hero-subtitle {
      font-size: 16px;
      color: #e2f3ff;
    }

    main {
      max-width: 1150px;
      margin: 0 auto;
      padding: 34px 18px 42px 18px;
      width: 100%;
      flex: 1;
    }

    .section {
      background: #fff;
      padding: 36px;
      border-radius: 14px;
      box-shadow: 0 14px 30px rgba(15,23,42,0.12);
      border-top: 4px solid var(--accent);
      margin-bottom: 20px;
    }

    .section-header {
      margin-bottom: 24px;
      text-align: center;
    }

    .section-header h2 {
      font-family: "Montserrat", sans-serif;
      font-size: 24px;
      color: var(--primary-dark);
    }

    .mobile-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1001;
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
    }

    .mobile-toggle svg { width: 20px; height: 20px; }

    @media (max-width: 1050px) {
      .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
      .sidebar.open { transform: translateX(0); }
      .main-wrapper { margin-left: 0; }
      .mobile-toggle { display: block; }
    }

    @media (max-width: 900px) {
      .hero-title { font-size: 32px; }
    }

    @media (max-width: 580px) {
      .hero-title { font-size: 28px; }
    }

    .login-wrapper {
      max-width: 420px;
      margin: 0 auto;
    }

    .form-group {
      margin-bottom: 14px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      color: #4b5563;
    }

    input[type="text"],
    input[type="password"],
    input[type="url"],
    input[type="number"],
    input[type="file"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-size: 13px;
      outline: none;
    }

    input[type="checkbox"] {
      margin-right: 4px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      font-family: "Montserrat", sans-serif;
      transition: background 0.2s ease, transform 0.1s ease;
    }

    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
    }

    .btn-sm {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 999px;
    }

    .login-error {
      color: #ef4444;
      font-size: 13px;
      margin-top: 6px;
    }

    .admin-layout {
      display: none;
    }

    .admin-layout.active {
      display: block;
    }

    .table-wrapper {
      overflow-x: auto;
      margin-top: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    th, td {
      padding: 8px 10px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      vertical-align: middle;
    }

    th {
      background: #f3f4f6;
      font-weight: 600;
      font-family: "Montserrat", sans-serif;
      color: #111827;
    }

    tr:hover {
      background: #f9fafb;
    }

    .section-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-top: 4px;
    }

    .actions-col {
      white-space: nowrap;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #e5f3ff;
      color: #0369a1;
      margin-left: 6px;
    }

    .stock-badge {
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 600;
    }

    .stock-in { background: #d1fae5; color: #065f46; }
    .stock-out { background: #fee2e2; color: #991b1b; }

    footer {
      background: #06121f;
      color: #cbd5f5;
      font-size: 13px;
      text-align: center;
      padding: 14px 0;
      margin-top: 24px;
    }

    .flex-between {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .mt-2 { margin-top: 8px; }
    .mt-3 { margin-top: 12px; }
    .mt-4 { margin-top: 16px; }

    .status-msg {
      font-size: 13px;
      color: #059669;
      margin-top: 6px;
    }

    .link-btn {
      font-size: 13px;
      color: var(--primary-dark);
      text-decoration: underline;
      cursor: pointer;
    }

    #cart-count {
      background: var(--accent);
      color: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      font-weight: bold;
      margin-left: 8px;
    }

    small {
      display: block;
      margin-top: 4px;
      font-size: 11px;
      color: #6b7280;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 8px;
    }

    .tab-btn {
      padding: 6px 12px;
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: #6b7280;
      transition: all 0.2s ease;
    }

    .tab-btn.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .image-preview {
      margin-top: 8px;
      max-width: 120px;
      border-radius: 6px;
      border: 1px solid #e5e7eb;
    }
  </style>
</head>
<body>

  <button class="mobile-toggle" onclick="toggleSidebar()" aria-label="Toggle Menu">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"></path>
    </svg>
  </button>

  <nav class="sidebar" id="sidebar">
    <a href="index.html" class="nav-logo">
      <img src="assets/logo.jpg" class="nav-logo-img" alt="ChemSus Logo">
      <span>ChemSus</span>
    </a>

    <ul class="nav-menu">
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About Us</a></li>
      <li><a href="products.html">Products</a></li>
      <li><a href="shop.html">Shop</a></li>
      <li><a href="collaboration.html">Collaboration</a></li>
      <li><a href="recognitions.html">Recognitions</a></li>
      <li><a href="investors.html">Investors</a></li>
      <li><a href="cart.html">Cart ðŸ›’ <span id="cart-count">0</span></a></li>
      <li><a href="contact.html">Contact us</a></li>
      <li><a href="request-sample.html">Request for Sample</a></li>
      <li><a href="orders.html">Orders</a></li>
      <li><a href="admin_shop.html" class="active">Admin Shop</a></li>
    </ul>

    <div class="search-section">
      <form class="search-form" id="siteSearchForm">
        <input type="search" id="siteSearchInput" class="search-input" placeholder="Search pages...">
        <span class="search-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"></path>
          </svg>
        </span>
      </form>
    </div>
  </nav>

  <div class="main-wrapper">
    <section class="hero">
      <div class="hero-content">
        <div class="hero-kicker">Admin Panel</div>
        <h1 class="hero-title">Manage Shop Items</h1>
        <p class="hero-subtitle">Secure dashboard to add, edit and remove items displayed on the public shop page.</p>
      </div>
    </section>

    <main>

      <section class="section" id="loginSection">
        <div class="section-header">
          <h2>Admin Login</h2>
          <p class="section-subtitle">Enter your admin credentials to manage the shop catalogue.</p>
        </div>

        <div class="login-wrapper">
          <div class="form-group">
            <label for="adminUsername">Username</label>
            <input type="text" id="adminUsername" placeholder="Enter admin username">
          </div>
          <div class="form-group">
            <label for="adminPassword">Password</label>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
          </div>
          <button class="btn btn-primary" id="loginBtn">Login</button>
          <div class="login-error" id="loginError" style="display:none;"></div>
        </div>
      </section>

      <section class="section admin-layout" id="adminSection">
        <div class="flex-between">
          <div>
            <h2 style="font-family:'Montserrat',sans-serif;font-size:22px;color:var(--primary-dark);">
              Shop Items <span class="badge" id="itemCountBadge">0 items</span>
            </h2>
            <p class="section-subtitle">Items managed here are instantly reflected on the public shop page.</p>
          </div>
          <button class="btn btn-secondary btn-sm" id="logoutBtn">Logout</button>
        </div>

        <div class="mt-4">
          <h3 style="font-family:'Montserrat',sans-serif;font-size:18px;color:var(--primary-dark);margin-bottom:8px;">Add / Edit Item</h3>
          <p class="section-subtitle">Define pricing, subtitle, badge text, stock status, image, and links.</p>

          <form id="shopItemForm" class="mt-3">
            <input type="hidden" id="itemId">

            <div class="form-group">
              <label for="itemName">Product name</label>
              <input type="text" id="itemName" placeholder="e.g. Calcium Levulinate" required>
            </div>

            <div class="form-group">
              <label for="itemSubtitle">Subtitle / short tagline</label>
              <input type="text" id="itemSubtitle" placeholder="e.g. Pharma-grade nutritional supplement" required>
            </div>

            <!-- Image Input Section -->
            <div class="form-group">
              <label>Product Image</label>
              <div class="tabs">
                <button type="button" class="tab-btn active" onclick="switchImageTab('upload')">Upload</button>
                <button type="button" class="tab-btn" onclick="switchImageTab('url')">Image URL</button>
                <button type="button" class="tab-btn" onclick="switchImageTab('filename')">Filename</button>
              </div>

              <!-- Upload Tab -->
              <div id="uploadTab" class="tab-content active">
                <input type="file" id="itemImageUpload" accept="image/*">
                <small>Upload image from your computer (JPG, PNG, GIF, etc.)</small>
                <img id="uploadPreview" class="image-preview" style="display:none;">
              </div>

              <!-- URL Tab -->
              <div id="urlTab" class="tab-content">
                <input type="url" id="itemImageUrl" placeholder="e.g. https://example.com/image.jpg">
                <small>Enter full image URL</small>
                <img id="urlPreview" class="image-preview" style="display:none;">
              </div>

              <!-- Filename Tab -->
              <div id="filenameTab" class="tab-content">
                <input type="text" id="itemImageFilename" placeholder="e.g. product.jpeg">
                <small>Filename stored in assets/ folder (e.g., cl.jpeg)</small>
              </div>
            </div>

            <div class="form-group">
              <label for="itemFeatures">Features (comma separated)</label>
              <input type="text" id="itemFeatures" placeholder="e.g. 99.5% purity, GMP certified, Tablet & capsule ready">
            </div>

            <div class="form-group">
              <label for="itemMoreLink">More details link (relative)</label>
              <input type="text" id="itemMoreLink" placeholder="e.g. products/calcium-levulinate.html">
            </div>

            <div class="form-group">
              <label for="itemPrice">Price (â‚¹ per kg)</label>
              <input type="number" id="itemPrice" min="0" step="0.01" placeholder="e.g. 2500" required>
            </div>

            <div class="form-group">
              <label for="itemBadge">Badge text (optional)</label>
              <input type="text" id="itemBadge" placeholder="e.g. Free sample available">
            </div>

            <div class="form-group" style="display: flex; align-items: center; gap: 6px; font-size: 13px;">
              <input type="checkbox" id="itemShowBadge">
              <label for="itemShowBadge" style="margin-bottom:0;">Show badge on card</label>
            </div>

            <div class="form-group">
              <label for="itemStockStatus">Stock Status</label>
              <select id="itemStockStatus" required>
                <option value="in-stock">In Stock</option>
                <option value="out-of-stock">Out of Stock</option>
              </select>
            </div>

            <button type="submit" class="btn btn-primary" id="saveItemBtn">Save item</button>
            <button type="button" class="btn btn-secondary" id="resetFormBtn" style="margin-left:8px;">Clear form</button>
            <div class="status-msg" id="statusMsg" style="display:none;"></div>
          </form>
        </div>

        <div class="mt-4">
          <div class="flex-between">
            <h3 style="font-family:'Montserrat',sans-serif;font-size:18px;color:var(--primary-dark);">Existing Shop Items</h3>
            <span class="link-btn" onclick="window.location.href='shop.html'">View public shop page</span>
          </div>
          <div class="table-wrapper">
            <table id="itemsTable">
              <thead>
                <tr>
                  <th style="width:50px;">ID</th>
                  <th style="width:140px;">Image</th>
                  <th>Name</th>
                  <th>Subtitle</th>
                  <th>Price (â‚¹)</th>
                  <th>Badge</th>
                  <th>Stock</th>
                  <th>More link</th>
                  <th class="actions-col">Actions</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </section>

    </main>

    <footer>
      Â© 2025 ChemSus Technologies Pvt Ltd. All rights reserved.
    </footer>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }
    window.toggleSidebar = toggleSidebar;

    function switchImageTab(tabName) {
      // Hide all tabs
      document.getElementById('uploadTab').classList.remove('active');
      document.getElementById('urlTab').classList.remove('active');
      document.getElementById('filenameTab').classList.remove('active');

      // Deactivate all buttons
      const buttons = document.querySelectorAll('.tab-btn');
      buttons.forEach(btn => btn.classList.remove('active'));

      // Show selected tab
      if (tabName === 'upload') {
        document.getElementById('uploadTab').classList.add('active');
        buttons[0].classList.add('active');
      } else if (tabName === 'url') {
        document.getElementById('urlTab').classList.add('active');
        buttons[1].classList.add('active');
      } else if (tabName === 'filename') {
        document.getElementById('filenameTab').classList.add('active');
        buttons[2].classList.add('active');
      }
    }
    window.switchImageTab = switchImageTab;

    function getDefaultShopItems() {
      return [
        { id: 1, name: 'Calcium Levulinate', subtitle: 'Pharma-grade nutritional supplement', image: 'cl.jpeg', imageType: 'filename', features: ['99.5% purity, GMP certified', 'Calcium bioavailability enhancer', 'Tablet & capsule formulation ready'], price: 2500, badge: '', showBadge: false, stockStatus: 'in-stock', moreLink: 'products/calcium-levulinate.html' },
        { id: 2, name: 'Sodium Levulinate', subtitle: 'Natural preservative & stabilizer', image: 'sl.jpeg', imageType: 'filename', features: ['Food-grade antimicrobial', 'ECOCERT approved cosmetic preservative', 'Stable in pH 7â€“9 range'], price: 1800, badge: 'Free sample available', showBadge: true, stockStatus: 'in-stock', moreLink: 'products/sodium-levulinate.html' },
        { id: 3, name: 'Levulinic Acid', subtitle: 'Versatile platform chemical', image: 'la.jpeg', imageType: 'filename', features: ['98%+ purity', 'Key building block for derivatives', 'Low color & odor'], price: 1200, badge: 'Free sample available', showBadge: true, stockStatus: 'in-stock', moreLink: 'products/levulinic-acid.html' },
        { id: 4, name: '5-Hydroxymethylfurfural (5-HMF)', subtitle: 'Biomass-derived platform chemical', image: '5hmf.jpeg', imageType: 'filename', features: ['Derived from sugars & cellulose', 'Intermediate for fuels & polymers', 'High chemical versatility'], price: 3200, badge: '', showBadge: false, stockStatus: 'in-stock', moreLink: 'products/5-hmf.html' },
        { id: 5, name: 'Ethyl Levulinate', subtitle: 'Green solvent & fuel additive', image: 'el.jpeg', imageType: 'filename', features: ['Bio-based ester', 'Used in flavors & fragrances', 'Low toxicity, biodegradable'], price: 2200, badge: '', showBadge: false, stockStatus: 'in-stock', moreLink: 'products/ethyl-levulinate.html' },
        { id: 6, name: 'Methyl Levulinate', subtitle: 'Renewable solvent & intermediate', image: 'ml.jpeg', imageType: 'filename', features: ['Biomass-derived', 'Used in coatings & resins', 'High purity, clean odor'], price: 2000, badge: '', showBadge: false, stockStatus: 'in-stock', moreLink: 'products/methyl-levulinate.html' }
      ];
    }

    function loadShopItems() {
      const stored = JSON.parse(localStorage.getItem('chemsusShopItems'));
      if (!stored || !Array.isArray(stored) || stored.length === 0) {
        const defaults = getDefaultShopItems();
        localStorage.setItem('chemsusShopItems', JSON.stringify(defaults));
        return defaults;
      }
      return stored;
    }

    function saveShopItems(items) {
      localStorage.setItem('chemsusShopItems', JSON.stringify(items));
    }

    document.addEventListener('DOMContentLoaded', function () {
      const ADMIN_USER = 'admin';
      const ADMIN_PASS = 'chemsus123';

      const loginSection = document.getElementById('loginSection');
      const adminSection = document.getElementById('adminSection');
      const loginBtn = document.getElementById('loginBtn');
      const loginError = document.getElementById('loginError');
      const logoutBtn = document.getElementById('logoutBtn');

      const itemsTableBody = document.querySelector('#itemsTable tbody');
      const itemForm = document.getElementById('shopItemForm');
      const itemIdField = document.getElementById('itemId');
      const itemNameField = document.getElementById('itemName');
      const itemSubtitleField = document.getElementById('itemSubtitle');
      const itemImageUpload = document.getElementById('itemImageUpload');
      const itemImageUrl = document.getElementById('itemImageUrl');
      const itemImageFilename = document.getElementById('itemImageFilename');
      const uploadPreview = document.getElementById('uploadPreview');
      const urlPreview = document.getElementById('urlPreview');
      const itemFeaturesField = document.getElementById('itemFeatures');
      const itemMoreLinkField = document.getElementById('itemMoreLink');
      const itemPriceField = document.getElementById('itemPrice');
      const itemBadgeField = document.getElementById('itemBadge');
      const itemShowBadgeField = document.getElementById('itemShowBadge');
      const itemStockStatusField = document.getElementById('itemStockStatus');
      const statusMsg = document.getElementById('statusMsg');
      const resetFormBtn = document.getElementById('resetFormBtn');
      const itemCountBadge = document.getElementById('itemCountBadge');

      // Image upload preview
      itemImageUpload.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (event) {
            uploadPreview.src = event.target.result;
            uploadPreview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        }
      });

      // Image URL preview
      itemImageUrl.addEventListener('input', function () {
        if (this.value) {
          urlPreview.src = this.value;
          urlPreview.onerror = function () {
            urlPreview.style.display = 'none';
          };
          urlPreview.onload = function () {
            urlPreview.style.display = 'block';
          };
        } else {
          urlPreview.style.display = 'none';
        }
      });

      function updateItemCount() {
        const items = loadShopItems();
        itemCountBadge.textContent = items.length + ' items';
      }

      function getImageSource(item) {
        if (!item.image) return null;
        if (item.imageType === 'upload' || item.imageType === 'base64') {
          return item.image; // base64 data
        } else if (item.imageType === 'url') {
          return item.image; // full URL
        } else if (item.imageType === 'filename') {
          return 'assets/' + item.image; // filename
        }
        return item.image;
      }

      function renderItemsTable() {
        const items = loadShopItems();
        itemsTableBody.innerHTML = '';

        items.forEach(item => {
          const tr = document.createElement('tr');

          const tdId = document.createElement('td');
          tdId.textContent = item.id;

          const tdImage = document.createElement('td');
          if (item.image) {
            const imgContainer = document.createElement('div');
            imgContainer.style.textAlign = 'center';
            
            const img = document.createElement('img');
            img.src = getImageSource(item);
            img.alt = item.name;
            img.style.width = '60px';
            img.style.height = '60px';
            img.style.objectFit = 'contain';
            img.style.borderRadius = '6px';
            img.style.border = '1px solid #e5e7eb';
            img.style.marginBottom = '6px';
            img.style.display = 'block';
            
            const filename = document.createElement('div');
            filename.textContent = item.image;
            filename.style.fontSize = '11px';
            filename.style.color = '#6b7280';
            filename.style.wordBreak = 'break-word';
            
            imgContainer.appendChild(img);
            imgContainer.appendChild(filename);
            tdImage.appendChild(imgContainer);
          } else {
            tdImage.textContent = '-';
          }

          const tdName = document.createElement('td');
          tdName.textContent = item.name;

          const tdSubtitle = document.createElement('td');
          tdSubtitle.textContent = item.subtitle;

          const tdPrice = document.createElement('td');
          tdPrice.textContent = item.price;

          const tdBadge = document.createElement('td');
          tdBadge.textContent = item.showBadge && item.badge ? item.badge : '-';

          const tdStock = document.createElement('td');
          const stockBadge = document.createElement('span');
          stockBadge.className = `stock-badge ${item.stockStatus === 'in-stock' ? 'stock-in' : 'stock-out'}`;
          stockBadge.textContent = item.stockStatus === 'in-stock' ? 'IN STOCK' : 'OUT OF STOCK';
          tdStock.appendChild(stockBadge);

          const tdLink = document.createElement('td');
          tdLink.textContent = item.moreLink || '';

          const tdActions = document.createElement('td');
          tdActions.className = 'actions-col';

          const editBtn = document.createElement('button');
          editBtn.textContent = 'Edit';
          editBtn.className = 'btn btn-secondary btn-sm';
          editBtn.style.marginRight = '6px';
          editBtn.type = 'button';
          editBtn.addEventListener('click', function (e) {
            e.preventDefault();
            loadItemIntoForm(item.id);
          });

          const delBtn = document.createElement('button');
          delBtn.textContent = 'Delete';
          delBtn.className = 'btn btn-danger btn-sm';
          delBtn.type = 'button';
          delBtn.addEventListener('click', function (e) {
            e.preventDefault();
            deleteItem(item.id);
          });

          tdActions.appendChild(editBtn);
          tdActions.appendChild(delBtn);

          tr.appendChild(tdId);
          tr.appendChild(tdImage);
          tr.appendChild(tdName);
          tr.appendChild(tdSubtitle);
          tr.appendChild(tdPrice);
          tr.appendChild(tdBadge);
          tr.appendChild(tdStock);
          tr.appendChild(tdLink);
          tr.appendChild(tdActions);

          itemsTableBody.appendChild(tr);
        });
      }

      function loadItemIntoForm(id) {
        const items = loadShopItems();
        const item = items.find(i => i.id === id);
        if (!item) return;
        itemIdField.value = item.id;
        itemNameField.value = item.name || '';
        itemSubtitleField.value = item.subtitle || '';
        
        // Load image based on type
        if (item.imageType === 'filename') {
          switchImageTab('filename');
          itemImageFilename.value = item.image || '';
        } else if (item.imageType === 'url') {
          switchImageTab('url');
          itemImageUrl.value = item.image || '';
          urlPreview.src = item.image || '';
          if (item.image) urlPreview.style.display = 'block';
        } else if (item.imageType === 'upload' || item.imageType === 'base64') {
          switchImageTab('upload');
          uploadPreview.src = item.image || '';
          if (item.image) uploadPreview.style.display = 'block';
        }

        itemFeaturesField.value = (item.features || []).join(', ');
        itemMoreLinkField.value = item.moreLink || '';
        itemPriceField.value = item.price || '';
        itemBadgeField.value = item.badge || '';
        itemShowBadgeField.checked = !!item.showBadge;
        itemStockStatusField.value = item.stockStatus || 'in-stock';
        statusMsg.style.display = 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      function deleteItem(id) {
        if (!confirm('Are you sure you want to delete this item?')) return;
        let items = loadShopItems();
        items = items.filter(i => i.id !== id);
        saveShopItems(items);
        renderItemsTable();
        updateItemCount();
        statusMsg.textContent = 'Item deleted successfully.';
        statusMsg.style.display = 'block';
        statusMsg.style.color = '#ef4444';
      }

      function clearForm() {
        itemIdField.value = '';
        itemNameField.value = '';
        itemSubtitleField.value = '';
        itemImageUpload.value = '';
        itemImageUrl.value = '';
        itemImageFilename.value = '';
        uploadPreview.style.display = 'none';
        urlPreview.style.display = 'none';
        itemFeaturesField.value = '';
        itemMoreLinkField.value = '';
        itemPriceField.value = '';
        itemBadgeField.value = '';
        itemShowBadgeField.checked = false;
        itemStockStatusField.value = 'in-stock';
        switchImageTab('filename');
      }

      resetFormBtn.addEventListener('click', function (e) {
        e.preventDefault();
        clearForm();
        statusMsg.style.display = 'none';
      });

      function getNextItemId(items) {
        if (!items.length) return 1;
        return Math.max.apply(null, items.map(i => i.id || 0)) + 1;
      }

      itemForm.addEventListener('submit', function (e) {
        e.preventDefault();

        let items = loadShopItems();

        const idValue = itemIdField.value ? parseInt(itemIdField.value, 10) : null;
        const name = itemNameField.value.trim();
        const subtitle = itemSubtitleField.value.trim();
        const price = parseFloat(itemPriceField.value);
        const moreLink = itemMoreLinkField.value.trim();
        const badge = itemBadgeField.value.trim();
        const showBadge = itemShowBadgeField.checked;
        const stockStatus = itemStockStatusField.value;
        const featuresStr = itemFeaturesField.value.trim();
        const features = featuresStr ? featuresStr.split(',').map(f => f.trim()).filter(Boolean) : [];

        // Determine which image input is active
        let image = '';
        let imageType = 'filename';

        // Check which tab is active and get the image data
        const uploadTab = document.getElementById('uploadTab').classList.contains('active');
        const urlTab = document.getElementById('urlTab').classList.contains('active');
        const filenameTab = document.getElementById('filenameTab').classList.contains('active');

        if (uploadTab) {
          if (itemImageUpload.files.length > 0) {
            // Convert to base64
            const reader = new FileReader();
            reader.onload = function (event) {
              image = event.target.result;
              imageType = 'upload';
              saveItem(image, imageType);
            };
            reader.readAsDataURL(itemImageUpload.files[0]);
            return; // Wait for async operation
          }
        } else if (urlTab) {
          image = itemImageUrl.value.trim();
          imageType = 'url';
        } else if (filenameTab) {
          image = itemImageFilename.value.trim();
          imageType = 'filename';
        }

        function saveItem(image, imageType) {
          if (!name || !subtitle || isNaN(price)) {
            alert('Please fill in product name, subtitle and price.');
            return;
          }

          if (idValue) {
            items = items.map(i => i.id === idValue ? { ...i, name, subtitle, image, imageType, price, moreLink, badge, showBadge, stockStatus, features } : i);
            statusMsg.textContent = 'Item updated successfully.';
          } else {
            const newId = getNextItemId(items);
            items.push({ id: newId, name, subtitle, image, imageType, price, moreLink, badge, showBadge, stockStatus, features });
            statusMsg.textContent = 'Item added successfully.';
          }

          saveShopItems(items);
          renderItemsTable();
          updateItemCount();
          statusMsg.style.display = 'block';
          statusMsg.style.color = '#059669';
          clearForm();
        }

        // If no file upload, save directly
        if (!uploadTab || itemImageUpload.files.length === 0) {
          saveItem(image, imageType);
        }
      });

      function setLoggedInState(isLoggedIn) {
        if (isLoggedIn) {
          loginSection.style.display = 'none';
          adminSection.classList.add('active');
          localStorage.setItem('chemsusAdminShopLoggedIn', 'true');
          renderItemsTable();
          updateItemCount();
        } else {
          loginSection.style.display = 'block';
          adminSection.classList.remove('active');
          localStorage.removeItem('chemsusAdminShopLoggedIn');
        }
      }

      if (localStorage.getItem('chemsusAdminShopLoggedIn') === 'true') {
        setLoggedInState(true);
      } else {
        setLoggedInState(false);
      }

      loginBtn.addEventListener('click', function () {
        const user = document.getElementById('adminUsername').value.trim();
        const pass = document.getElementById('adminPassword').value.trim();
        if (user === ADMIN_USER && pass === ADMIN_PASS) {
          loginError.style.display = 'none';
          setLoggedInState(true);
        } else {
          loginError.textContent = 'Invalid username or password.';
          loginError.style.display = 'block';
        }
      });

      logoutBtn.addEventListener('click', function () {
        setLoggedInState(false);
      });

      (function () {
        const cart = JSON.parse(localStorage.getItem('chemsusCart')) || [];
        const count = cart.reduce((sum, item) => sum + item.quantity, 0);
        const badge = document.getElementById('cart-count');
        if (badge) badge.textContent = count;
      })();

      document.getElementById('siteSearchForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const query = document.getElementById('siteSearchInput').value.trim().toLowerCase();
        if (!query) return;
        if (query.includes('shop')) window.location.href = 'shop.html';
        else window.location.href = 'index.html';
      });
    });
  </script>
</body>
</html>
